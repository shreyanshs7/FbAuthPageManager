<!DOCTYPE html>
<html>

<head>
    <title>Dashboard</title>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body>
    <h3 class="center orange-text">Page Details</h3>
    <div class="container" style="padding-top: 5%;">
        <div class="card">
            <div class="card-content center">
                <div class="row">
                    <div class="input-field container">
                        <input id="name" type="text" class="validate" value="{{ page_details.name }}">
                        <label for="name">Name</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field container">
                        <input id="category" type="text" class="validate" value="{{ page_details.category }}">
                        <label for="category">Category</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field container">
                        <input id="about" type="text" class="validate" value="{{ page_details.about }}">
                        <label for="about">About</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field container">
                        <input id="city" type="text" class="validate" value="{{ page_details.location.city }}">
                        <label for="city">City</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field container">
                        <input id="country" type="text" class="validate" value="{{ page_details.location.country }}">
                        <label for="country">Country</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field container">
                        <input id="street" type="text" class="validate" value="{{ page_details.location.street }}">
                        <label for="street">Street</label>
                    </div>
                </div>
                <button type="submit" class="btn yellow black-text" id="edit">EDIT DETAILS</button>
                <button type="submit" class="btn yellow black-text" id="save">SAVE DETAILS</button>
            </div>
        </div>
    </div>
    <input id="access_token" name="pageToken" value="{{ page.access_token }}" hidden>
    <input id="access_token" name="pageId" value="{{ page_details.id }}" hidden>

    <!--JavaScript at end of body for optimized loading-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script>
        function statusChangeCallback(response) {
            console.log('statusChangeCallback');
            console.log(response);
            if (response.status === 'connected') {
                console.log(response);
            }
        }
        function checkLoginState() {
            FB.getLoginStatus(function (response) {
                statusChangeCallback(response);
            });
        }
        window.fbAsyncInit = function () {
            FB.init({
                appId: '421576098604229',
                cookie: true, 
                xfbml: true, 
                version: 'v3.2'
            });
            FB.getLoginStatus(function (response) {
                statusChangeCallback(response);
            });
        };

        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));

        $(document).ready(function () {
            document.getElementById("name").disabled = true;
            document.getElementById("category").disabled = true;
            document.getElementById("about").disabled = true;
            document.getElementById("city").disabled = true;
            document.getElementById("country").disabled = true;
            document.getElementById("street").disabled = true;
            $("#save").hide();
        });
        $("#edit").click(function (e) {
			e.preventDefault();
			$("#edit").hide();
			$("#save").show();
			document.getElementById("name").disabled = false;
            document.getElementById("category").disabled = false;;
            document.getElementById("about").disabled = false;
            document.getElementById("city").disabled = false;
            document.getElementById("country").disabled = false;
            document.getElementById("street").disabled = false;;
		});

        function checkNull(parameter, Name){
            if(parameter == ""){
                M.toast({ html: Name + " cannot be empty" });
                return false;
            } else {
                return true;
            }
        }

        $("#save").click(function(e){
            e.preventDefault();
            var name = $("#name").val();
            var category = $("#category").val();
            var about = $("#about").val();
            var city = $("#city").val();
            var country = $("#country").val();
            var street = $("#street").val();

            var nameCheck = checkNull(name, "Name");
            var categoryCheck = checkNull(category, "Category");
            var aboutCheck = checkNull(about, "About");
            var cityCheck = checkNull(city, "City");
            var countryCheck = checkNull(country, "Country");
            var streetCheck = checkNull(street, "Street")
            if(nameCheck && categoryCheck && aboutCheck && cityCheck && countryCheck && streetCheck){
                $.ajax({
                    type : "POST",
                    url : '/update',
                    data : {
                        pageId : $("#pageId").val(),
                        pageToken : $("#pageToken").val(),
                        name : name,
                        category : category,
                        about : about,
                        city : city,
                        country : country,
                        street : street
                    },
                    success : function(data) {
                        if(data.success){
                            location.reload();
                        }
                    }
                });
            }
        });
    </script>
</body>

</html>