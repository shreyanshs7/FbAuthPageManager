<!DOCTYPE html>
<html>

<head>
    <title>Dashboard</title>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body>
    <h3 class="center orange-text">Page Details</h3>
    <h5 class="center">{{ page_details.name }}</h5>
    <div class="container" style="padding-top: 5%;">
        <div class="card">
            <div class="card-content center">
                <div class="row">
                    <div class="input-field container">
                        <input id="description" type="text" class="validate" value="{{ page_details.description }}">
                        <label for="description">Description</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field container">
                        <input id="impressum" type="text" class="validate" value="{{ page_details.impressum }}">
                        <label for="impressum">Impressum</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field container">
                        <input id="about" type="text" class="validate" value="{{ page_details.about }}">
                        <label for="about">About</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field container">
                        <input id="phone" type="text" class="validate" value="{{ page_details.phone }}">
                        <label for="phone">Phone</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field container">
                        <input id="website" type="text" class="validate" value="{{ page_details.website }}">
                        <label for="website">Website</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field container">
                        <input id="company_overview" type="text" class="validate" value="{{ page_details.company_overview }}">
                        <label for="company_overview">Company Overview</label>
                    </div>
                </div>
                <button type="submit" class="btn orange black-text" id="edit">EDIT DETAILS</button>
                <button type="submit" class="btn green white-text" id="save">SAVE DETAILS</button>
            </div>
        </div>
    </div>
    <input id="pageToken" name="pageToken" value="{{ page_token }}" hidden>
    <input id="pageId" name="pageId" value="{{ page_details.id }}" hidden>

    <!--JavaScript at end of body for optimized loading-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script>
        function statusChangeCallback(response) {
            console.log('statusChangeCallback');
            console.log(response);
            if (response.status === 'connected') {
                console.log(response);
            }
        }
        function checkLoginState() {
            FB.getLoginStatus(function (response) {
                statusChangeCallback(response);
            });
        }
        window.fbAsyncInit = function () {
            FB.init({
                appId: '421576098604229',
                cookie: true, 
                xfbml: true, 
                version: 'v3.2'
            });
            FB.getLoginStatus(function (response) {
                statusChangeCallback(response);
            });
        };

        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));

        $(document).ready(function () {
            document.getElementById("description").disabled = true;
            document.getElementById("impressum").disabled = true;
            document.getElementById("about").disabled = true;
            document.getElementById("phone").disabled = true;
            document.getElementById("website").disabled = true;
            document.getElementById("company_overview").disabled = true;
            $("#save").hide();
        });
        $("#edit").click(function (e) {
			e.preventDefault();
			$("#edit").hide();
			$("#save").show();
			document.getElementById("description").disabled = false;
            document.getElementById("impressum").disabled = false;;
            document.getElementById("about").disabled = false;
            document.getElementById("phone").disabled = false;
            document.getElementById("website").disabled = false;
            document.getElementById("company_overview").disabled = false;
		});

        function checkNull(parameter, Name){
            if(parameter == ""){
                M.toast({ html: Name + " cannot be empty" });
                return false;
            } else {
                return true;
            }
        }

        function phoneNumberValidate(number){
            if(number.length == 10){
                return true;
            } else {
                return false;
            }
        }

        $("#save").click(function(e){
            e.preventDefault();
            var description = $("#description").val();
            var impressum = $("#impressum").val();
            var about = $("#about").val();
            var phone = $("#phone").val();
            var website = $("#website").val();
            var company_overview = $("#company_overview").val();

            var descriptionCheck = checkNull(description, "Description");
            var impressumCheck = checkNull(impressum, "Impressum");
            var aboutCheck = checkNull(about, "About");
            var phoneCheck = checkNull(phone, "Phone");
            var websiteCheck = checkNull(website, "Website");
            var company_overviewCheck = checkNull(company_overview, "Company Overview")
            var phoneValidate = phoneNumberValidate(phone);
            if(descriptionCheck && impressumCheck && aboutCheck && phoneCheck && websiteCheck && company_overviewCheck && phoneNumberValidate){
                $.ajax({
                    type : "POST",
                    url : '/update',
                    data : {
                        pageId : $("#pageId").val(),
                        pageToken : $("#pageToken").val(),
                        description : description,
                        impressum : impressum,
                        about : about,
                        phone : phone,
                        website : website,
                        company_overview : company_overview
                    },
                    success : function(data) {
                        if(data.success){
                            location.reload();
                        }
                    }
                });
            }
        });
    </script>
</body>

</html>